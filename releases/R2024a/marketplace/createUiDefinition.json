{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "text1",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                    "text": "Need help?",
                    "link": {
                        "label": " Click here for instructions",
                        "uri": "https://www.mathworks.com/help/cloudcenter/ug/run-network-license-manager-from-azure-marketplace.html"
                    }
                }
            }
        ],
        "steps": [
            {
                "name": "LicenseManagerVirtualMachineConfig",
                "label": "Network License Manager virtual machine settings",
                "subLabel": {
                    "preValidation": "Configure virtual machine resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Network License Manager virtual machine settings",
                "elements": [
                    {
                        "name": "vmSize",
                        "type": "Microsoft.Compute.SizeSelector",
                        "label": "Virtual machine size",
                        "toolTip": "Choose the virtual machine size to provision. The default size is suitable for running MATLAB. Larger sizes can increase costs.",
                        "recommendedSizes": [
                            "Standard_B1ms"
                        ],
                        "osPlatform": "Windows",
                        "count": "1"
                    },
                    {
                        "name": "adminUsername",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Admin Username",
                        "toolTip": "Admin username, this is used to login to the Network License Manager for MATLAB dashboard.",
                        "defaultValue": "manager",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-zA-Z].{6,63}$",
                            "validationMessage": "The username must be of minimum 7 characters long and should start with an alphabet."
                        }
                    },
                    {
                        "name": "userPassword",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Password",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "Admin password for the chosen username. This is used to login to the Network License Manager for MATLAB dashboard.",
                        "constraints": {
                            "required": true,
                            "regex": "^((?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])|(?=.*[0-9])(?=.*[a-z])(?=.*[!@#$%^&*])|(?=.*[0-9])(?=.*[A-Z])(?=.*[!@#$%^&*])|(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*])).{12,72}$",
                            "validationMessage": "Choose the admin password for the chosen username. This password is required when logging into any instance using remote desktop protocol. For the deployment to succeed, your password must meet the Azure password requirements. For information on the password requirements, see https://docs.microsoft.com/en-us/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm"
                        },
                        "options": {
                            "hideConfirmation": false
                        },
                        "visible": true
                    },
                    {
                        "name": "clientIPAddresses",
                        "type": "Microsoft.Common.TextBox",
                        "label": "IP addresses",
                        "toolTip": "Client CIDR defining the range of IP addresses permitted to connect to the virtual machine. For example: 192.168.100.14/24",
                        "defaultValue": "",
                        "constraints": {
                            "required": true,
                            "regex": "^([0-9]{1,3}\\.){3}[0-9]{1,3}(/([0-9]|[1-2][0-9]|3[0-2]))?.{1,1}$",
                            "validationMessage": "Address must use valid CIDR notation. For example: 192.168.100.14/24"
                        }
                    },
                    {
                        "name": "text1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Click here for more information about the Network License Manager on mathworks.com.",
                            "uri": "https://www.mathworks.com/help/licensingoncloud/matlab-on-the-cloud.html"
                        }
                    },
                    {
                        "name": "text2",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Need help?",
                            "link": {
                                "label": " Click here for instructions",
                                "uri": "https://www.mathworks.com/help/matlab/matlab_env/run-matlab-from-azure-marketplace.html"
                            }
                        }
                    }
                ]
            },
            {
                "name": "networking",
                "label": "Networking",
                "subLabel": {
                    "preValidation": "Configure virtual network resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Virtual Network",
                "elements": [
                    {
                        "name": "virtualNetwork",
                        "type": "Microsoft.Network.VirtualNetworkCombo",
                        "label": {
                            "virtualNetwork": "Virtual network",
                            "subnets": "Subnets"
                        },
                        "toolTip": {
                            "virtualNetwork": "Name of the Virtual Network resource to use. By default a new resource is created and added to the resource group.",
                            "subnets": "A subnet is a range of IP addresses in your virtual network, which can be used to isolate virtual machines from each other or from the Internet."
                        },
                        "defaultValue": {
                            "name": "netlm-vnet",
                            "addressPrefixSize": "/16"
                        },
                        "constraints": {
                            "minAddressPrefixSize": "/16"
                        },
                        "options": {
                            "hideExisting": false
                        },
                        "subnets": {
                            "subnet1": {
                                "label": "Subnet",
                                "defaultValue": {
                                    "name": "netlm-subnet",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/24",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": true
                                }
                            }
                        },
                        "visible": true
                    },
                    {
                        "name": "text3",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Need help?",
                            "link": {
                                "label": " Click here for instructions",
                                "uri": "https://www.mathworks.com/help/matlab/matlab_env/run-matlab-from-azure-marketplace.html"
                            }
                        }
                    }
                ]
            }
        ],
        "outputs": {
            "location": "[location()]",
            "instanceType": "[steps('LicenseManagerVirtualMachineConfig').vmSize]",
            "clientIPAddress": "[steps('LicenseManagerVirtualMachineConfig').clientIPAddresses]",
            "adminUsername": "[steps('LicenseManagerVirtualMachineConfig').adminUsername]",
            "adminPassword": "[steps('LicenseManagerVirtualMachineConfig').userPassword]",
            "virtualNetworkNewOrExisting": "[steps('networking').virtualNetwork.newOrExisting]",
            "virtualNetworkResourceID": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', steps('networking').virtualNetwork.resourceGroup, '/providers/Microsoft.Network/virtualNetworks/', steps('networking').virtualNetwork.name)]",
            "subnetName": "[steps('networking').virtualNetwork.subnets.subnet1.name]"
        }
    }
}
